<!DOCTYPE html>
<html>
<body>
<canvas id="imgCanvas" width="1200" height="750"></canvas>
<form>
Backgroud Color:
<input id="inputbckcolor" type="text" value="#585858">
</br>
Start Color(Ring):
<input id="inputcolor" type="text" value="88,88,88">
End Color(Ring):
<input id="inputendcolor" type="text" value="88,88,88">
Point Color:
<input id="inputcolorpt" type="text" value="255,0,0">
</br>
Start Radius(Icon):
<input id="inputstartr" type="text" value="80">
End Radius(Ring):
<input id="inputendr" type="text" value="0">
End Radius(Point):
<input id="inputendrpt" type="text" value="10">
</br>
Duration(ms):
<input id="inputdur" type="text" value="1000">
<input id="inputdurpt" type="text" value="200">
<!-- Dynamic Icon:
<input type="checkbox" id="dynamicIconCheck"> -->
</form>
<button id='drawBttn' onclick="draw()" style="display: none;">draw</button>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
// icon images
var icons = ["./ab_icon/ab1.png", "./ab_icon/ab2.png", "./ab_icon/ab3.png", "./ab_icon/ab4.png", "./ab_icon/ab5.png", "./ab_icon/ab6.png", "./ab_icon/ab7.png", "./ab_icon/ab8.png", "./ab_icon/ab9.png", "./ab_icon/ab10.png"];
var icons = ["../icons/ab/ab1.png", "../icons/ab/ab2.png", "../icons/ab/ab3.png", "../icons/ab/ab4.png", "../icons/ab/ab5.png", "../icons/ab/ab6.png", "../icons/ab/ab7.png", "../icons/ab/ab8.png", "../icons/ab/ab9.png"];
var pointloc = [[0.500,0.500],[0.050,0.050],[0.950,0.500],[0.275,0.275],[0.500,0.950],[0.950,0.050],[0.275,0.725],[0.050,0.500],[0.950,0.950],[0.725,0.725],[0.500,0.050],[0.050,0.950],[0.725,0.275],[0.500,0.500]];

var cvs, ctx;
var sW, sH;
var iconsize = 80;
var step = 30;
var circleLineWidth = 5;
var iconsound = new Audio('../icons/sound/s1.mp3');
</script>

<script type="text/javascript">
// preload icons
var iconset = new Array(icons.length);
function preloadIcons(idx){
	if(idx >= icons.length){
		alert('Image preloaded!')
		setup();
		return;
	}
	iconset[idx] = new Image();
	iconset[idx].onload = function(){
		preloadIcons(idx+1);
	};
	iconset[idx].src = icons[idx];
}
preloadIcons(0);
/*
$.preloadImages = function(imglist) {
	for(var i = 0; i < imglist.length; i++){
		$("<img />").attr("src", imglist[i]);
	}
	// enable drawing calibration points
	setup();
}
$.preloadImages(icons);
*/

function setup(){
	cvs = document.getElementById('imgCanvas');
	ctx = imgCanvas.getContext('2d');
	$('#drawBttn').css({left:1000, top:50});	
	sW = cvs.width, sH = cvs.height;

	bckcolor='#585858';
	ctx.fillStyle = bckcolor;
	ctx.fillRect(0,0,cvs.width,cvs.height);
	$('#drawBttn').show();
}

function draw(){
	drawIcon(0);
}
function drawIcon(pointidx){

	if (pointidx >= pointloc.length) return;
	// randomly select a bird
	iconidx = Math.floor(Math.random()*icons.length);

	ctx.fillStyle = bckcolor;
	ctx.fillRect(0,0,sW,sH);
	
	color = eval('[' + $("#inputcolor").val() + ']');
	color_pt = eval('[' + $("#inputcolorpt").val() + ']');
	endcolor = eval('[' + $("#inputendcolor").val() + ']');
	iconsize = eval($("#inputstartr").val());
	start_r = iconsize * 0.75;
	end_r = eval($("#inputendr").val());
	end_r_pt = eval($("#inputendrpt").val());
	duration = eval($("#inputdur").val());
	duration_pt = eval($("#inputdurpt").val());
	bckcolor = $('#inputbckcolor').val();

	

	x = sW*pointloc[pointidx][0];
	y = sH*pointloc[pointidx][1];

	iconsound.play();
	// draw icon
	ctx.drawImage(iconset[iconidx], x-iconsize/2, y-iconsize/2, iconsize, iconsize);
	ctx.lineWidth = circleLineWidth;

	// draw closing door: a ring
	/***********
	// only bird
	drawDynamicRing(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, function(){
		drawIcon(pointidx+1);
	});
	*/	
	/************/
	// bird and dot
	drawDynamicRing(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, function(){
		drawDynamicCirc(cvs, ctx, x, y, bckcolor, color_pt, color_pt, duration_pt, 0, end_r_pt, step, function(){
			drawIcon(pointidx+1);
		});
	});
	
}

// draw closing ring animation
function drawDynamicRing(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, callback){
	var num = Math.round(duration/step);
	var r_set = new Array(num);
	var c_set = new Array(num);
	for( var i = 0; i < num; i++){
		r_set[i] = start_r+ (end_r-start_r)/num*i; // set of radius
		colormid = new Array(3);
		for (var j = 0; j < 3; j++){
			colormid[j] = color[j] + (endcolor[j]-color[j])/num*i;
		}
		colormid = colormid.map(Math.round);
		c_set[i] = 'rgb(' + colormid[0] +',' + colormid[1] + ',' + colormid[2] + ')';
	}
	drawRingLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, 0, callback);
}

function drawRingLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx, callback){
	if(idx >= r_set.length) {
		if(callback) callback();
		return;
	}
	drawCircle(ctx, x, y, r_set[idx], c_set[idx], false);
	setTimeout(function(){
		drawRingLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx+1, callback);
	}, step);
}

// draw dynamic circle animation
function drawDynamicCirc(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, callback){
	var num = Math.round(duration/step);
	var r_set = new Array(num);
	var c_set = new Array(num);
	for( var i = 0; i < num; i++){
		r_set[i] = start_r+ (end_r-start_r)/num*i; // set of radius
		colormid = new Array(3);
		for (var j = 0; j < 3; j++){
			colormid[j] = color[j] + (endcolor[j]-color[j])/num*i;
		}
		colormid = colormid.map(Math.round);
		c_set[i] = 'rgb(' + colormid[0] +',' + colormid[1] + ',' + colormid[2] + ')';
	}
	drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, 0, callback);
}

function drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx, callback){
	if(idx >= r_set.length) {
		if(callback) callback();
		return;
	}
	ctx.fillStyle = bckcolor;
	ctx.fillRect(0,0,cvs.width,cvs.height);
	drawCircle(ctx, x, y, r_set[idx], c_set[idx], true);
	setTimeout(function(){
		drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx+1, callback);
	}, step);
}

// draw a circle, filled or stroke
function drawCircle(context, x, y, r, color, fill){
	context.beginPath();
	context.arc(x, y, r, 0, 2 * Math.PI, true);
	context.closePath();
	if(fill){
		context.fillStyle = color;
		context.fill();	
	}else{
		context.strokeStyle = color;
		context.stroke();
	}
}
</script>

</body>
</html>


