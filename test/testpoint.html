<!DOCTYPE html>
<html>
<body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>


<canvas id="imgCanvas" width="640" height="360"></canvas>
<form>
Backgroud Color:
<input id="inputbckcolor" type="text" value="black">
</br>
Start Color:
<input id="inputcolor" type="text" value="255,0,0">
End Color:
<input id="inputendcolor" type="text" value="255,0,0">
</br>
Start Radius:
<input id="inputstartr" type="text" value="25">
End Radius:
<input id="inputendr" type="text" value="8">
</br>
Duration(ms):
<input id="inputdur" type="text" value="2000">
Round Trip:
<input type="checkbox" id="roundtripCheck">
</form>
<button id='drawBttn' onclick="draw()" style="display: none;">draw</button>

<script type="text/javascript">
cvs = document.getElementById('imgCanvas');
ctx = imgCanvas.getContext('2d');
$('#drawBttn').css({left:1000, top:50});

x = cvs.width/2, y = cvs.height/2;
step = 30;
bckcolor='#000';
ctx.fillStyle = bckcolor;
ctx.fillRect(0,0,cvs.width,cvs.height);
$('#drawBttn').show();
var RT = false;

$( "#roundtripCheck" ).on( "click", function() {
	RT = document.getElementById("roundtripCheck").checked;
});

function draw(){
	color = eval('[' + $("#inputcolor").val() + ']');
	endcolor = eval('[' + $("#inputendcolor").val() + ']');
	start_r = eval($("#inputstartr").val());
	end_r = eval($("#inputendr").val());
	duration = eval($("#inputdur").val());
	bckcolor = $('#inputbckcolor').val();
	if(RT){
		drawDynamicCirc(cvs, ctx, x, y, bckcolor, color, endcolor, duration/2, start_r, end_r, step, function(){
			drawDynamicCirc(cvs, ctx, x, y, bckcolor, color, endcolor, duration/2, end_r, start_r, step, null);});	
	}else{
		drawDynamicCirc(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, null);
	}
	
}

// draw circle animation
function drawDynamicCirc(cvs, ctx, x, y, bckcolor, color, endcolor, duration, start_r, end_r, step, callback){
	var num = Math.round(duration/step);
	var r_set = new Array(num);
	var c_set = new Array(num);
	for( var i = 0; i < num; i++){
		r_set[i] = start_r+ (end_r-start_r)/num*i; // set of radius
		colormid = new Array(3);
		for (var j = 0; j < 3; j++){
			colormid[j] = color[j] + (endcolor[j]-color[j])/num*i;
		}
		colormid = colormid.map(Math.round);
		c_set[i] = 'rgb(' + colormid[0] +',' + colormid[1] + ',' + colormid[2] + ')';
	}
	drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, 0, callback);
}
function drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx, callback){
	if(idx >= r_set.length) {
		if(callback) callback();
		return;
	}
	ctx.fillStyle = bckcolor;
	ctx.fillRect(0,0,cvs.width,cvs.height);
	drawCircle(ctx, x, y, r_set[idx], c_set[idx], true);
	setTimeout(function(){
		drawCircleLoop(cvs, ctx, x, y, r_set, c_set, bckcolor, step, idx+1, callback);
	}, step);
}


function drawCircle(context, x, y, r, color, fill){
	context.beginPath();
	context.arc(x, y, r, 0, 2 * Math.PI, true);
	context.closePath();
	if(fill){
		context.fillStyle = color;
		context.fill();	
	}else{
		context.strokeStyle = color;
		context.stroke();
	}
}
</script>

</body>
</html>
